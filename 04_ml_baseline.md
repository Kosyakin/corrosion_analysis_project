## ML Baseline: результаты и рекомендации

Этот документ суммирует, что было сделано в ноутбуке `notebooks/04_ml_baseline.ipynb`, какие получены результаты и что улучшать дальше.

### Что мы сделали
- Загрузили данные из представления `pipeline_corrosion_analysis_view`.
- Подготовили признаки:
  - числовые: геометрия, операционные, химические, агрегаты, `material_resistance_score`;
  - категориальные: `component_type_name` (top-K со сборкой категории `Other`), one-hot encoding.
- Простая импутация медианами для числовых пропусков.
- Бейзлайны моделей:
  - Линейная регрессия с L2-регуляризацией (Ridge) + масштабирование.
  - Случайный лес (RandomForestRegressor).
- Оценка качества:
  - простой train/val сплит (для первичной оценки);
  - K=5 кросс-валидация, с приоритетом GroupKFold по `installation` для предотвращения утечки между объектами одной установки.
- Интерпретация:
  - важности признаков у RF;
  - модуль коэффициентов у Ridge.
- Сохранение артефактов: `data/ml_baseline_results.json` (сводка CV и топ-факторы).

### Результаты (по кросс-валидации)
По итогам 5-фолдовой CV (с группировкой по `installation`):

- Ridge:
  - MAE ≈ 0.0694 ± 0.0271
  - RMSE ≈ 0.1578 ± 0.1248
  - R² ≈ −0.073 ± 0.076
- RandomForest:
  - MAE ≈ 0.0723 ± 0.0310
  - RMSE ≈ 0.1646 ± 0.1222
  - R² ≈ −0.227 ± 0.167

Интерпретация: на групповой CV обе модели пока не превосходят наивный прогноз по дисперсии (R² < 0). То есть предсказательная сила текущего фичсета и/или конфигурации моделей — слабая.

### Топ-признаки (интерпретация)
- RandomForest — важности (Top 10):
  1) `operating_temperature` (0.168)
  2) `butane_content` (0.097)
  3) `operating_pressure` (0.091)
  4) `total_sulfur_compounds` (0.085)
  5) `sulfur_content` (0.075)
  6) `water_content` (0.073)
  7) `wall_thickness` (0.068)
  8) `cross_sectional_area` (0.062)
  9) `diameter_to_thickness_ratio` (0.057)
  10) `inner_diameter` (0.040)
  - `material_resistance_score` также вошел в список, но с невысокой важностью (~0.010).

- Ridge — по модулю коэффициентов (Top 10):
  1) `cross_sectional_area` (−0.028)
  2) `total_sulfur_compounds` (+0.025)
  3) `diameter_to_thickness_ratio` (−0.018)
  4) `h2s_content` (−0.015)
  5) `wall_thickness` (+0.014)
  6) `outer_diameter` (+0.014)
  7) `radius` (+0.014)
  8) `component_type_name_Отвод` (+0.014)
  9) `inner_diameter` (+0.014)
  10) `sulfur_content` (−0.010)
  - `material_resistance_score` имеет небольшой вклад (≈ +0.0013 по модулю), что может указывать на слабую линейную связь в текущем фичсете.

Замечания:
- Геометрия и операционные параметры стабильно оказываются среди важных/значимых, что согласуется с EDA.
- Химические факторы (сернистые соединения) дают сигнал, но суммарная предсказательная сила остаётся низкой.

### Почему качество низкое сейчас
- Групповая CV по `installation` делает задачу реалистичнее (нет утечки между объектами одной установки), но и сложнее.
- Возможна сильная гетерогенность по типам компонентов и материалам, которую простые модели не улавливают.
- Много слабых, частично коррелирующих признаков; недостаток нелинейных/взаимодействующих фич.
- Часть химических показателей имеет низкую вариативность или пропуски; полезный сигнал «разбавлен».

### Что улучшать дальше (план работ)
1) Моделирование
   - Попробовать бустинги: LightGBM/CatBoost (устойчивее к нелинейностям и смешанным типам данных).
   - Добавить per-segment модели: отдельные модели для крупных `component_type_name`, либо мультизадачный подход.
   - Рассмотреть трансформацию цели (например, `log1p(corrosion_rate)`), если распределение сильно скошено; сравнить с MAE/RMSE.
   - Добавить устойчивые лоссы (Huber/Quantile) и/или взвешивание по типам/установкам.

2) Признаки
   - Интеракции: `тип×геометрия`, `материал×геометрия`, `температура×сернистые`.
   - Временные признаки (если доступно): возраст/год запуска, сезонность, стационарные кластеры по установкам.
   - Нормировки: геом. признаки относить к толщине стенки/диаметру (безразмерные отношения).
   - Пересмотреть и расширить материал: `material_resistance_score` как категория-группа + набор индикаторов, градации стойкости.

3) Валидация и устойчивость
   - Зафиксировать GroupKFold; дополнительно протестировать временную CV (если есть дата измерений), чтобы смоделировать прогноз в будущее.
   - Вести сравнение по сегментам: метрики по типам компонентов и по установкам (стабильность/дрейф).

4) Данные
   - Улучшить сбор/вариативность по кислотам: сейчас сигнал практически отсутствует.
   - Проверить единицы измерения и привести к единому стандарту по площадкам.
   - Рассмотреть отбраковку шумных измерений и согласованность корреляций по кластерам.

5) Тюннинг и интерпретация
   - Провести Grid/Random/Bayesian Search для гиперпараметров RF/GBDT.
   - Интерпретация SHAP/Permutation Importance на бустингах, PDP/ICE-профили для ключевых факторов.

### Вывод
Бейзлайны заданы корректно и дают ориентир: при строгой групповой валидации текущий фичсет недостаточно информативен (R² < 0). Это нормальная стартовая точка: переход к нелинейным моделям, обогащение признаков и сегментация по типам/материалам обычно существенно поднимают качество. Рекомендуется двигаться по пунктам улучшений выше и регулярно валидировать прогресс на GroupKFold.

## Отчет по V6 (06_param_sweeper) и per-installation (05_ml_baseline_avt)

### Цель и постановка задачи
Построить воспроизводимую процедуру сравнения наборов признаков по установкам (`installation`) и оценить, как различные комбинации химических и базовых признаков влияют на качество регрессии скорости коррозии. Дополнительно — проанализировать эффект сегментации «модель на установку» из 05-й линии.

### Методология
- Данные: представление `pipeline_corrosion_analysis_view` (геометрия, материал, операционные, химия, агрегаты; целевая — `corrosion_rate`).
- Блок 06_param_sweeper:
  - Конфигурация экспериментов (наборы ключей признаков) и автоматическая генерация матрицы признаков по мэппингу ключ→SQL-колонка.
  - Импутация: химические NaN→0 (отсутствие компонента), прочие — медиана.
  - Оценка per-installation: для каждой установки (n≥150) — hold-out split (80/20), метрики MAE, RMSE, R² для Ridge и RandomForest.
  - Результаты сохраняются для каждого эксперимента (CSV per-installation) и в единую сводку (all_results/pivots).
- Блок 05_ml_baseline_avt (на всём корпусе):
  - Отдельные модели по каждой установке (Ridge, RandomForest) с локальными метриками; сохранение per-installation результатов.

### Результаты (характерные наблюдения)
- Базовые признаки (геометрия+материал+температура+давление) уже дают устойчивый сигнал для RandomForest; Ridge остаётся близка к нулевой объясняющей способности.
- Добавление отдельных химических признаков (например, `sulfur_content`, агрегата `total_sulfur_compounds`, `h2s_content`) даёт небольшой позитивный сдвиг R² для RF (десятые доли процента до нескольких процентов, в зависимости от установки), но не меняет картину радикально.
- Эксперимент «все химические» (максимальный набор) показывает, что широкое включение химии увеличивает размерность, однако прирост качества для RF ограничен и неоднороден по установкам; для Ridge добавление множества слабосвязанных/скоррелированных признаков часто не улучшает R².
- Per-installation подход (05) подтверждает выраженную гетерогенность: для части установок RF достигает заметно более высоких R² (локально до ~0.25–0.32), тогда как для других рост ограничен (~0.20–0.24 и ниже). Это указывает на различия в режимах эксплуатации, составах, датчиках и/или качестве измерений между установками.

### Интерпретация и гипотезы
- Гетерогенность процессов: различия в технологических режимах и составах среды между установками приводят к тому, что глобальная единая модель «размазывает» связи. Локальные (per-installation) модели лучше захватывают специфические закономерности.
- Информативность химии: часть химических признаков обладает низкой вариативностью или сильной корреляцией между собой/с температурой, что снижает добавочную информацию. Агрегаты (например, `total_sulfur_compounds`) сопоставимы по полезности с детальными компонентами.
- Нелинейности и взаимодействия: преимущество RF над Ridge указывает на нелинейную природу зависимостей и важность взаимодействий (температура×химия, давление×геометрия). Линейная модель без расширенных взаимодействий и трансформаций теряет силу.
- Измерения и шум: неоднородность датчиков, различия в единицах/градуировках, пропуски (заполненные нулями для химии) и возможный дрейф по времени могут маскировать эффекты.

### Практические выводы
- Сегментация по установкам оправдана: локальные модели дают более высокие R² для части установок. Для промышленного применения целесообразно поддерживать набор per-installation моделей либо включить явные взаимодействия «установка×признак» в единую модель.
- Усиление фичсета должно фокусироваться не на количестве химических компонент, а на их осмысленных агрегатах и взаимодействиях с операционными параметрами. Простое добавление десятков химических признаков даёт ограниченный прирост.

### Рекомендации и дальнейшие шаги
1) Модели:
   - Перейти к бустингам (CatBoost/LightGBM) с регуляризацией и ранней остановкой; ожидается рост R² за счёт учёта нелинейностей и устойчивой работы с шумом.
   - Рассмотреть per-installation модели как стандарт, а также вариант мета-модели, учитывающей «установка×признак» взаимодействия.
2) Признаки:
   - Расширить и систематизировать взаимодействия: температура×сернистые, давление×геометрия; лог-трансформации для скошенных распределений.
   - Использовать агрегаты (суммарные индексы серы, хлора, кислот) вместо избыточного числа коррелирующих компонент.
   - Добавить возраст/время с последней замены/ремонта, индикаторы периодов эксплуатации.
3) Данные:
   - Проверить и нормировать единицы измерений по установкам, калибровки датчиков, консистентность временных меток; по возможности повысить вариативность по кислотам.
   - Вести мониторинг дрейфа признаков и качества модели по установкам.
4) Оценка и управление экспериментами:
   - Использовать свипер (06) для документирования всех запусков: сохранять набор ключей, время, метрики, установку.
   - Добавить сравнение против наивной базы (константа/медиана) и целевые пороги (например, R²≥0.25) для принятия решений о внедрении.

### Заключение
Процедура 06_param_sweeper показала, что систематическое варьирование наборов признаков с фиксацией per-installation метрик повышает прозрачность экспериментов и подчёркивает гетерогенность объектов. Разделение по установкам (05) — эффективная стратегия, частично компенсирующая межустановочные различия. Для существенного повышения предсказательного качества необходимо сочетать: (i) более выразительные модели (GBDT), (ii) осмысленные взаимодействия и агрегаты признаков, (iii) улучшения качества и согласования данных между установками.

# Отчет: анализ факторов, влияющих на скорость коррозии трубопроводного оборудования

## Данные и методология
- Источник данных: `pipeline_corrosion_analysis_view` через модуль `src/database.py`.
- Подготовка:
  - Фильтрация записей без `corrosion_rate` и физически осмысленные границы 0–10 мм/год.
  - Не заполняли NaN нулями для хим. признаков (сохраняем вариативность).
  - Контроль типов для числовых колонок.
- Группы признаков: геометрические, операционные, химические (основные, углеводороды, кислоты), агрегатные.
- Метрики связи с целью: безопасные Pearson и Spearman (исключение NaN и признаков с нулевой вариацией). Для итоговых ранжирований использовался |Spearman|.
- Сегментация: оценка связей по крупным типам компонентов (`component_type_name`).

## Ключевые выводы (текущая версия анализа)
- **Геометрические факторы**:
  - Наиболее стабильный положительный сигнал у `wall_thickness` (толщина стенки). Масштаб связи слабый (порядка |r| ≈ 0.05–0.10), но воспроизводимый.
  - Дополнительно положительно связаны: `cross_sectional_area`, `outer_diameter`, `inner_diameter`, `radius`, `diameter_to_thickness_ratio` (все — слабые связи).
- **Операционные факторы**:
  - `operating_temperature` демонстрирует слабую положительную связь (≈ 0.08 по Пирсону ранее).
  - `operating_pressure` — связь близка к нулю на агрегированном уровне.
- **Химические факторы (основные/углеводороды)**:
  - `sulfur_content` — слабая положительная связь; `oxygen_content` — слабая отрицательная.
  - Углеводороды преимущественно показывают слабые отрицательные связи; наиболее заметно — `propylene_content` (слабая отрицательная).
- **Кислоты и агрегаты кислот**:
  - `sulfuric_acid_content`, `acetic_acid_content`, `naphthenic_acid_content` — исключены из корреляционного анализа: в текущих данных фактически отсутствует вариация (значения ≈ 0 → деление на ноль при стандартной корреляции).
  - `total_acids` также теряет информативность по той же причине.
- **Агрегаты серы**:
  - `total_sulfur_compounds` — слабая положительная связь (согласуется с ролью сернистых соединений).
- **Сегментация по типам компонентов**:
  - Распределение `corrosion_rate` заметно отличается между типами.
  - Внутри отдельных типов ранги факторов и сами коэффициенты меняются, что указывает на целесообразность сегментных/«per-type» моделей либо признаков взаимодействия.

## Сохраненные артефакты
- `data/correlations_features_vs_corrosion.csv` — таблица Pearson/Spearman по признакам vs `corrosion_rate` с ранжированием по |Spearman|.
- `data/feature_quality_report.csv` — отчет качества признаков (доля пропусков, уникальность, стандартное отклонение, признак нулевой вариативности).

## Практические рекомендации
- **Моделирование**
  - Строить базовые модели прогноза `corrosion_rate`: линейные/ридж/ластик-нет, деревья/GBDT (CatBoost/LightGBM), с кросс-валидацией по объектам/кластерам оборудования.
  - Рассмотреть отдельные модели по типам компонентов или добавить взаимодействия `component_type_name × геометрия`.
  - Использовать робастные метрики (MAE, R2) и интерпретацию (SHAP) для валидации влияния признаков.
- **Признаки**
  - Включить геометрические признаки и `component_type_name` (one-hot/target encoding).
  - Добавить производные признаки: отношения диаметров, нормализация геометрии относительно толщины стенки, комбинированные индексы сернистости.
  - Учесть время эксплуатации (если доступно `start_date_of_operation`): возраст, когорты запуска.
- **Качество данных**
  - Не заполнять химические NaN нулями на этапе анализа; при моделировании — явные индикаторы пропусков + осмысленные импутеры.
  - Пересмотреть сбор кислотных показателей: текущая нулевая вариативность делает признаки неинформативными; если технологически релевантно — улучшить измерения/градуировку.
  - Проверить единицы измерения и диапазоны по площадкам, унифицировать.
- **Аналитика и эксплуатация**
  - Выполнить стабильность признаков и дрейф во времени/по площадкам.
  - Построить частные зависимости (PDP/ICE) и профили риска для интерпретации.
  - Внедрить мониторинг качества входных данных и выходных прогнозов.

## Следующие шаги (на основе практики аналогичных исследований)
1. Пересэмплировать и сбалансировать обучающие когорты по типам компонентов, запустить baseline-модели (линейные и GBDT) с групповой CV.
2. Сконструировать перетиповые модели или мета-модель с признаком типа и взаимодействиями.
3. Провести отбор признаков по SHAP/Permutation Importance; сократить до компактного набора (≈ 10–20 признаков).
4. Расширить фичи: нелинейные трансформации геометрии, взаимодействия с температурой/давлением.
5. Улучшить сбор данных по кислотам (если релевантно процессу) — обеспечить вариативность и достоверность.
6. Подготовить пилот в прод: API/скрипт расчета, периодический расчет показателей риска коррозии по активам, мониторинг качества и реконфигурация при дрейфе.

---
Примечание: для корреляций использованы «безопасные» процедуры, исключающие признаки с нулевой вариативностью и строки с пропусками, что устраняет предупреждения NumPy и искажения оценок.
